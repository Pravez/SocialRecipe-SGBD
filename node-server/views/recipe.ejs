<!DOCTYPE html>
<html>
<head>
    <title>Social Recipe</title>
    <% include parts/headers.ejs %>

    <link href="components/bootstrap-star-rating/css/star-rating.css" media="all" rel="stylesheet" type="text/css"/>

    <script>
        var recipe_id = <%- rows[0]["id_recipe"] %>;
    </script>
</head>
<body>

<% include parts/toolbar.ejs %>

<div class="container">
    <div class="jumbotron">
        <h1><%= rows[0].recipe_name %></h1>
        <p>Recipe description</p>
        <% if(average_note !== -1) { %>
        <p>Average note : <input type="text" id="avg_rating" class="rating" value="<%= average_note %>"></p>
        <% } %>
    </div>
    <div class="col-md-12">
        <div class="col-md-6">
            <p>You'll need : </p>
            <ul>
                <% for(var i = 0;i < ingredients_rows.length;i++) { %>
                <li><%= ingredients_rows[i]["quantity"] %> <%= ingredients_rows[i]["unit_name"] %>
                    <% if(ingredients_rows[i]["quantity"] > 1){ %>
                    <%= "s" %>
                    <% } %>
                    of
                    <a href="/ingredient?id=<%= ingredients_rows[i]["id_ingredient"] %>"><%= ingredients_rows[i]["ingredient_name"] %></a>
                </li>
                <% } %>
            </ul>
        </div>
        <div class="col-md-4 col-md-offset-2 data">
            <% if(rows[0].preparation_time.minutes || rows[0].preparation_time.hours) { %>
            <div class="row">
                <div class="col-md-1">
                    <span class="glyphicon glyphicon-time"></span>
                </div>
                <div class="col-md-3">
                <span class="badge">
                    <% if(rows[0].preparation_time.minutes) { %>
                    <%= rows[0].preparation_time.minutes %> minutes
                    <% }else if(rows[0].preparation_time.hours) { %>
                    <%= rows[0].preparation_time.hours %> heures
                    <% } %>
                </span>
                </div>
                <div class="col-md-5">
                    Preparation time
                </div>
            </div>
            <% } %>
            <% if(rows[0].cooking_time.minutes || rows[0].cooking_time.hours) { %>
            <div class="row">
                <div class="col-md-1">
                    <span class="glyphicon glyphicon-time"></span>
                </div>
                <div class="col-md-3"><span class="badge">
                        <% if(rows[0].cooking_time.minutes) { %>
                        <%= rows[0].cooking_time.minutes %> minutes
                        <% }else if(rows[0].cooking_time.hours) { %>
                        <%= rows[0].cooking_time.hours %> heures
                        <% } %>
                    </span></div>
                <div class="col-md-5"> Cooking time</div>
            </div>
            <% } %>
            <% if(rows[0].waiting_time.minutes || rows[0].waiting_time.hours) { %>
            <div class="row">
                <div class="col-md-1">
                    <span class="glyphicon glyphicon-time"></span>
                </div>
                <div class="col-md-3">
                    <span class="badge">
                        <% if(rows[0].waiting_time.minutes) { %>
                        <%= rows[0].waiting_time.minutes %> minutes
                        <% }else if(rows[0].waiting_time.hours) { %>
                        <%= rows[0].waiting_time.hours %> heures
                        <% } %>
                    </span>
                </div>
                <div class="col-md-5"> Waiting time</div>
            </div>
            <% } %>
            <div class="row">
                <div class="col-md-1">
                    <span class="glyphicon glyphicon-cutlery"></span>
                </div>
                <div class="col-md-3">
                    <span class="badge"><%= rows[0].servings %></span>
                </div>
                <div class="col-md-5">
                    Servings
                </div>
            </div>
        </div>
        <div class="col-md-12" id="descriptions">
            <h2>Preparation by <%= description_rows[0]["pseudo"] %></h2>
            <p><%= description_rows[0]["description_text"] %></p>
        </div>
        <div class="col-md-12" id="all_preparations_div">
            <p><small>Want to see all preparations created ? <a href="#" id="all_preparations">click here</a></small></p>
        </div>
        <div class="col-md-12" style="margin-bottom:50px;">
            <h2>Comments on this recipe</h2>
            <% for(var j = 0;j < comments_rows.length;j++){ %>
            <h4><%= comments_rows[j]["pseudo"] %>
                <% if(notes_rows[comments_rows[j]["pseudo"]] ) { %>
                <span class="label label-default"><%= notes_rows[comments_rows[j]["pseudo"]] %></span>
                <% } %>
            </h4>
            <p><%= comments_rows[j]["comment_text"] %></p>
            <% } %>
        </div>
        <% if(session.username) { %>
        <div class="col-md-12">
            <form action="/recipe" method="post">
                <div class="col-md-12">
                    <div class="form-group">
                        <label for="rating">Rating : </label>
                        <input <% if(notes_rows[session.username]) { %>value="<%= notes_rows[session.username] %>" name="update_rating"
                               <% }else{ %> name="rating" <% } %> type="text" class="rating" id="rating" data-size="xs">
                        <input name="id_recipe" type="number" style="display:none;" value="<%= rows[0]["id_recipe"] %>">
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="form-group">
                        <label for="comment">Your comment : </label>
                        <textarea name="comment" class="form-control" rows="3"></textarea>
                    </div>
                </div>
                <div class="col-md-12">
                    <button type="submit" class="btn btn-default">Submit</button>
                </div>
            </form>
        </div>
        <% } %>
        <div class="col-md-12" style="height:50px;"></div>

    </div>
</div>

<script src="components/bootstrap-star-rating/js/star-rating.js" type="text/javascript"></script>
<script src="javascripts/recipe_description.js"></script>

</body>
</html>